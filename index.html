<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seadays — Sea Time Calculator (final revised)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:900px;margin:28px auto;padding:0 16px;color:#111}
  h1{font-size:1.6rem;margin-bottom:.2rem}
  p.lead{color:#444;margin-top:0}
  form{display:grid;gap:12px;background:#fafafa;padding:14px;border-radius:10px;box-shadow:0 4px 18px rgba(0,0,0,.06)}
  label{display:block;font-weight:600;font-size:.9rem}
  input[type="date"], input[type="number"], select{padding:8px;border-radius:6px;border:1px solid #ddd;min-width:160px}
  button{background:#0b63d6;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
  .result{margin-top:12px;padding:12px;border-radius:8px;background:#fff;border:1px solid #eee}
  small.disclaimer{display:block;color:#666;margin-top:8px}
  .log{margin-top:10px;font-size:.9rem;color:#333}
  .flex-between{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
  <h1>Seadays — Sea Time Calculator (Revised)</h1>
  <p class="lead">A simple tool to calculate sea time.</p>

  <form id="form" onsubmit="return false;">
    <div>
      <label for="start">Start Date (Joined Ship)</label>
      <input id="start" type="date" required />
    </div>

    <div>
      <label for="end">End Date (Left Ship)</label>
      <input id="end" type="date" required />
    </div>

    <div>
      <label for="watch">Watch System</label>
      <select id="watch">
        <option value="8h">8 hours watches</option>
        <option value="12h">12 hours watches</option>
      </select>
      <small>Choose the watch pattern worked during the period.</small>
    </div>

    <div>
      <label for="daysUnderway">Days Underway (at sea)</label>
      <input id="daysUnderway" type="number" min="0" placeholder="Optional — leave blank to use calculated days" />
    </div>

    <div>
      <label for="daysRefit">Days in refit / ashore (to exclude)</label>
      <input id="daysRefit" type="number" min="0" value="0" />
    </div>

    <div class="flex-between">
      <div>
        <button id="calc">Calculate Sea Time</button>
        <button id="reset" type="button" style="margin-left:8px;background:#888">Reset</button>
      </div>
    </div>

  </form>

  <div id="out" class="result" aria-live="polite">
    <div><strong>Total logged days:</strong> <span id="totalDays">—</span></div>
    <div><strong>Days at sea used:</strong> <span id="seaDays">—</span></div>
    <div><strong>Watch system:</strong> <span id="watchOut">—</span></div>

    <!-- Corrected total sea time -->
    <div><strong>Total sea time:</strong> <span id="totalSeaTime">—</span></div>

    <small class="disclaimer">Disclaimer: This is an estimation tool. Always refer to official regulations for formal records.</small>
  </div>

  <div class="log" id="log"></div>

<script>
  // Difference in days (end date NOT counted)
  function daysBetween(startDate, endDate) {
    const msPerDay = 24 * 60 * 60 * 1000;
    const s = Date.UTC(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
    const e = Date.UTC(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());
    return Math.round((e - s) / msPerDay);
  }

  const startEl = document.getElementById('start');
  const endEl = document.getElementById('end');
  const daysUnderwayEl = document.getElementById('daysUnderway');
  const daysRefitEl = document.getElementById('daysRefit');
  const watchEl = document.getElementById('watch');

  const totalDaysEl = document.getElementById('totalDays');
  const seaDaysEl = document.getElementById('seaDays');
  const watchOutEl = document.getElementById('watchOut');
  const totalSeaTimeEl = document.getElementById('totalSeaTime');
  const logEl = document.getElementById('log');

  function display(msg) {
    logEl.innerHTML = msg;
  }

  function calculate() {
    const start = startEl.value ? new Date(startEl.value) : null;
    const end = endEl.value ? new Date(endEl.value) : null;
    const refit = Math.max(0, Number(daysRefitEl.value) || 0);
    const explicitUnderway = Number(daysUnderwayEl.value) || null;

    if (!start || !end) {
      alert('Please choose both start and end dates.');
      return;
    }
    if (end <= start) {
      alert('End date must be after start date (end date is not counted).');
      return;
    }

    const totalLogged = daysBetween(start, end);

    let daysAtSea = explicitUnderway ? Math.max(0, explicitUnderway) : totalLogged;
    daysAtSea = Math.max(0, daysAtSea - refit);

    const watch = watchEl.value;
    let watchLabel = (watch === '8h') ? '8 hours watches' : '12 hours watches';

    // Corrected watch-based multiplier:
    // TOTAL SEA TIME = total logged days  OR  total logged days * 1.5
    let totalSeaTime = (watch === '8h')
      ? totalLogged
      : totalLogged * 1.5;

    totalSeaTime = Math.round(totalSeaTime * 100) / 100;

    totalDaysEl.textContent = totalLogged;
    seaDaysEl.textContent = daysAtSea;
    watchOutEl.textContent = watchLabel;
    totalSeaTimeEl.textContent = totalSeaTime;

    display(
      `From ${start.toLocaleDateString()} to ${end.toLocaleDateString()} = ${totalLogged} days`
      + (explicitUnderway ? ` | Using provided Days Underway: ${explicitUnderway}` : '')
      + (refit ? ` | Refit excluded: ${refit}` : '')
    );

    const csvRow = [
      start.toISOString().slice(0,10),
      end.toISOString().slice(0,10),
      totalLogged,
      daysAtSea,
      totalSeaTime,
      refit,
      watch
    ].join(',');
    
    let csvBox = document.getElementById('csvCopy');
    if (!csvBox) {
      const pre = document.createElement('pre');
      pre.id = 'csvCopy';
      pre.style.padding = '10px';
      pre.style.background = '#fff';
      pre.style.border = '1px dashed #ddd';
      pre.textContent = 'CSV row (copy to save):\n' + csvRow;
      logEl.appendChild(pre);
    } else {
      csvBox.textContent = 'CSV row (copy to save):\n' + csvRow;
    }
  }

  document.getElementById('calc').addEventListener('click', calculate);
  document.getElementById('reset').addEventListener('click', () => {
    startEl.value = ''; 
    endEl.value = ''; 
    daysUnderwayEl.value = ''; 
    daysRefitEl.value = '0'; 
    watchEl.value = '8h';
    totalDaysEl.textContent = '—'; 
    seaDaysEl.textContent = '—'; 
    watchOutEl.textContent = '—';
    totalSeaTimeEl.textContent = '—';
    logEl.innerHTML = '';
  });
</script>

</body>
</html>
